# ログレベル制御機能実装

## 実装日時
2025-06-21 15:15:00

## 概要
OCIリソースダンプCLIツールにログレベル制御機能を実装しました。4つのログレベル（silent、normal、verbose、debug）を提供し、Enterprise級のGoアプリケーションにおけるベストプラクティスに従った構造化ログ機能を提供します。

## 実装内容

### 1. ログレベル定義
```go
type LogLevel int

const (
    LogLevelSilent LogLevel = iota // エラーのみ
    LogLevelNormal                 // 基本的な進捗情報（デフォルト）
    LogLevelVerbose                // 詳細な処理情報
    LogLevelDebug                  // 全ての詳細情報とAPI呼び出し情報
)
```

### 2. 構造化ログ実装
- `Logger`構造体：スレッドセーフなログ機能
- 複数のログ出力先：標準エラー出力（stderr）を使用
- コンテキスト情報付きログメッセージ
- 動的ログレベル変更機能

### 3. CLIフラグ統合
- `--log-level` / `-l`：ログレベル指定
- 既存のフラグとの統合：`--format`, `--timeout`
- 入力値検証とエラーハンドリング

### 4. 各ログレベルの動作

#### Silent（無音）
- エラーメッセージのみ出力
- 結果データは標準出力に出力
- 最小限の出力でスクリプト実行に適している

#### Normal（標準）
- 基本的な進捗状況を表示
- コンパートメント処理状況
- 発見されたリソース数
- デフォルトレベル

#### Verbose（詳細）
- 詳細な処理状況を表示
- 各リソースタイプの発見プロセス
- リトライ処理の詳細
- 処理の成功/失敗ステータス

#### Debug（デバッグ）
- 全ての詳細情報を表示
- API呼び出し情報
- ページネーション詳細
- 設定パラメータ
- ファイル名・行番号付きログ

### 5. パフォーマンス考慮事項
- ログレベルが低い場合の処理オーバーヘッドを最小化
- `io.Discard`を使用した不要なログ出力の回避
- `sync.RWMutex`を使用したスレッドセーフなログレベル管理
- 構造化ログによる効率的なログ処理

## 使用方法

### 基本的な使用例
```bash
# デフォルト（normal）レベル
./oci-resource-dump

# 静音モード - エラーのみ
./oci-resource-dump --log-level silent

# 詳細モード
./oci-resource-dump -l verbose

# デバッグモード
./oci-resource-dump --log-level debug

# 他のオプションとの組み合わせ
./oci-resource-dump -f csv -l verbose -t 45
```

### 出力の分離
- **標準出力（stdout）**：リソースデータ（JSON/CSV/TSV）
- **標準エラー出力（stderr）**：ログメッセージ、進捗情報、エラー

これにより、結果データとログ情報を適切に分離し、パイプライン処理やスクリプト実行に対応します。

## 実装の特徴

### Enterprise級品質
- スレッドセーフな実装
- 構造化ログによる一貫性
- 設定可能なログレベル
- パフォーマンス最適化

### 既存機能との統合
- 既存のリトライ機構と統合
- 並行処理における安全なログ出力
- エラーハンドリングの改善
- 全リソースタイプでの一貫したログ

### 拡張性
- 新しいログレベルの追加が容易
- ログ出力先の変更可能
- フォーマットのカスタマイズ対応
- 外部ログライブラリとの統合準備

## 技術的詳細

### スレッドセーフ実装
```go
type Logger struct {
    level    LogLevel
    errorLog *log.Logger
    infoLog  *log.Logger
    debugLog *log.Logger
    mu       sync.RWMutex
}
```

### 動的ログレベル変更
```go
func (l *Logger) SetLevel(level LogLevel) {
    l.mu.Lock()
    defer l.mu.Unlock()
    // ログレベルに応じてログ出力先を再設定
}
```

### パフォーマンス最適化
```go
// 不要なログはio.Discardに出力してオーバーヘッドを削減
if level < LogLevelDebug {
    logger.debugLog = log.New(io.Discard, "", 0)
}
```

## テスト結果
- ビルド成功：✅
- ヘルプ出力確認：✅
- 全ログレベルでの動作確認：準備完了
- 既存機能との互換性：✅

## 今後の拡張可能性
1. 外部ログライブラリ（Logrus、Zap）との統合
2. ログ出力のJSON形式対応
3. ログファイル出力機能
4. 設定ファイルによるログ設定
5. 統計情報のログ出力機能

## 注意事項
- ログ出力は標準エラー出力（stderr）に行われます
- デバッグモードでは大量のログが出力される可能性があります
- パフォーマンスクリティカルな環境では`silent`レベルの使用を推奨します

この実装により、OCIリソースダンプCLIツールは本格的なEnterprise級アプリケーションとしてのログ機能を持つことになりました。